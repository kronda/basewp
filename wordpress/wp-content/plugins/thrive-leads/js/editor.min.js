/*! Thrive Leads - The ultimate Lead Capture solution for wordpress - 2015-12-02
* https://thrivethemes.com 
* Copyright (c) 2015 * Thrive Themes */
var TVE_Content_Builder=TVE_Content_Builder||{};TVE_Content_Builder.ext=TVE_Content_Builder.ext||{};var TL_Editor=TL_Editor||{};!function(a){a(document).ready(function(){a(".tl-state-minimized").draggable({handle:".multistep-lightbox-heading",stop:function(a,c){"JSON"in window&&b.set_cookie("tve_leads_states_pos",JSON.stringify(c.position))}})}),TL_Editor.on_menu_show=function(a){return a.is(".thrv-ribbon")?(load_control_panel_menu(a,"form_ribbon"),!0):a.is(".thrv-leads-widget")?(load_control_panel_menu(a,"form_widget"),!0):a.is(".thrv-leads-slide-in")?(load_control_panel_menu(a,"form_slide_in"),!0):a.is(".thrv-leads-form-box")?(load_control_panel_menu(a,"lead_form"),!0):a.is(".thrv-leads-screen-filler")?(load_control_panel_menu(a,"form_screen_filler"),!0):a.is(".thrv-greedy-ribbon")?(load_control_panel_menu(a,"form_greedy_ribbon"),!0):void 0},TL_Editor.editable_elements_extend=function(a){return a},TL_Editor.load_button_values=function(a,b,c){switch(a){case"form_ribbon":var d=parseInt(b.find(".tve-ribbon-content").outerWidth());isNaN(d)||c.find("#ribbon_size").val(d).trigger("change");break;case"form_slide_in":var d=TVE_Content_Builder.max_width_px(b),e=parseInt(b.css("borderBottomWidth"));d&&c.find("#slide_in_size").val(d).trigger("change"),e=isNaN(e)?0:e,c.find(".tl-border-width").val(e);break;case"form_widget":var e=parseInt(b.css("borderBottomWidth"));e=isNaN(e)?0:e,c.find(".tl-border-width").val(e);break;case"lead_form":var e=parseInt(b.css("borderBottomWidth"));e=isNaN(e)?0:e,c.find(".tl-border-width").val(e);break;case"form_screen_filler":var d=TVE_Content_Builder.max_width_px(b.find(".tve-screen-filler-content"));d||(d=parseInt(b.find(".tve-screen-filler-content").outerWidth())),c.find("#screen_filler_size").val(d).trigger("change");break;case"form_greedy_ribbon":var d=parseInt(b.find(".tve-greedy-ribbon-content").outerWidth());isNaN(d)||c.find("#greedy_ribbon_size").val(d).trigger("change")}if(c.find(".tve_brdr_radius").length){var f=parseInt(b.css("border-top-left-radius"));f=isNaN(f)?0:f,c.find(".tve_brdr_radius").val(f).trigger("change")}if(c.find(".tve_brdr_width").length){var e=parseInt(b.css("borderBottomWidth"));e=isNaN(e)?0:e,c.find(".tve_brdr_width").val(e)}},TL_Editor.media_selected=function(a,b,c){switch(b){case"tl_form_bg":a.tve_leads_form().bgImage(c)}},TL_Editor.open_template_chooser=function(){jQuery("#tl-tpl-chooser").click(),setTimeout(function(){jQuery("#tve_lightbox_frame").find(".tve-lightbox-close").hide(),hide_sub_menu()},0)},TVE_Content_Builder.add_filter("menu_show",TL_Editor.on_menu_show),TVE_Content_Builder.add_filter("editable_elements",TL_Editor.editable_elements_extend),TVE_Content_Builder.add_filter("load_button_values",TL_Editor.load_button_values),TVE_Content_Builder.add_filter("tcb_media_selected",TL_Editor.media_selected),tve_leads_page_data.has_content||TVE_Content_Builder.add_filter("main_ajax_callback",TL_Editor.open_template_chooser);var b={tpl_ajax:function(a,b){var c={type:"post",dataType:"json",url:tve_leads_page_data.ajaxurl};if(TVE_Editor_Page.overlay(),a.action=tve_leads_page_data.tpl_action,a._key=a._key||tve_leads_page_data._key,a.post_id=tve_leads_page_data.post_id,a.security=tve_leads_page_data.security,c.data=a,b)for(var d in b)c[d]=b[d];return jQuery.ajax(c,a)},state_ajax:function(a,b){var c={type:"post",dataType:"json",url:tve_leads_page_data.ajaxurl};if(TVE_Editor_Page.overlay(),a.action=tve_leads_page_data.state_action,a._key=tve_leads_page_data._key,a.post_id=tve_leads_page_data.post_id,a.security=tve_leads_page_data.security,a.active_state=tve_leads_page_data._key,c.data=a,b)for(var d in b)c[d]=b[d];return jQuery.ajax(c,a)},set_cookie:function(a,b,c,d){d=d||"/",c=c||2592e3;var e,f=new Date;c=parseInt(c),f.setTime(f.getTime()+1e3*c),e=f.toUTCString(),document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+";expires="+e+";path="+d}};TVE_Content_Builder.ext.tve_leads={template:{choose:function(a){var c=jQuery("#tve-leads-tpl").find(".tve_cell_selected:visible");return c.length?tve_leads_page_data.has_content&&"1"===c.find(".multi_step").val()&&!confirm(tve_leads_page_data.L.confirm_multi_step)?!1:(b.tpl_ajax({custom:"choose",tpl:c.find(".lp_code").val()}).done(TVE_Content_Builder.ext.tve_leads.state.insertResponse),TVE_Content_Builder.controls.lb_close(),void jQuery("#tve_lightbox_frame").find(".tve-lightbox-close").show()):(alert(tve_leads_page_data.L.alert_choose_tpl),!1)},reset:function(){return confirm(tve_leads_page_data.L.confirm_tpl_reset)?(b.tpl_ajax({custom:"reset"}).done(TVE_Content_Builder.ext.tve_leads.state.insertResponse),void TVE_Content_Builder.controls.lb_close()):!1},filter:function(){var a=jQuery("#tve-leads-tpl"),b=[];return jQuery(".tve-tpl-filter:checked").each(function(){b.push(this.value)}),b.length?(a.find(".tve_grid_cell").hide(),void jQuery.each(b,function(b,c){a.find(".tve_grid_cell.tve-tpl-"+c).show()})):a.find(".tve_grid_cell").show()},save:function(a){var c=a.parent().find("input#tve_landing_page_name").val();return c?void b.tpl_ajax({custom:"save",name:a.parent().find("input#tve_landing_page_name").val()}).done(function(a){jQuery("#tve_landing_page_msg").removeClass("tve_warning").addClass("tve_success").html(a.message),jQuery("#tl-saved-templates").html(a.list),TVE_Editor_Page.overlay("close")}):void tve_add_notification(tve_leads_page_data.L.tpl_name_required,!0,5e3)},delete_saved:function(){var a=jQuery("#tve-leads-tpl").find(".tve_cell_selected:visible");return a.length?confirm(tve_leads_page_data.L.tpl_confirm_delete)?void b.tpl_ajax({custom:"delete",tpl:a.find(".lp_code").val()},{dataType:"html"}).done(function(a){jQuery("#tl-saved-templates").html(a),TVE_Editor_Page.overlay("close")}):!1:(alert(tve_leads_page_data.L.alert_choose_tpl),!1)},get_saved:function(){var a=jQuery("#tl-user-current-templates:checked").length;return b.tpl_ajax({custom:"get_saved",current_template:a},{dataType:"html"}).done(function(a){TVE_Editor_Page.overlay("close"),jQuery("#tl-saved-templates").html(a)}),!1},user_tab_clicked:function(){setTimeout(this.get_saved,150)}},open_form_bg_media:function(a,b){thrive_open_media(null,"load","tl_form_bg",b)},form_settings:function(a,b,c){hide_sub_menu();var d=jQuery(a.data("element-selector"));c.target=d,c.currentTarget=d,tve_editor_init(c,d)},formBorderWidth:function(a,b){b.css("border-width",a.val())},state:{insertResponse:function(a){a||tve_add_notification("Something went wrong",!0),jQuery(".tve_custom_style,.tve_user_custom_style").remove(),jQuery("head").append(a.custom_css),a.css.thrive_events||jQuery("#thrive_events-css,#tve_lightbox_post-css").remove(),jQuery.each(a.css,function(a,b){jQuery("#"+a+"-css").length||jQuery("head").append('<link href="'+b+'" type="text/css" rel="stylesheet" id="'+a+'-css"/>')}),jQuery("body").removeClass("tve-l-open tve-o-hidden tve-lightbox-page").addClass(a.body_class),jQuery("#tve-leads-page-tpl-options").html(a.page_buttons),tve_path_params=jQuery.extend(tve_path_params,a.tve_path_params,!0),tve_leads_page_data.current_css!=a.tve_leads_page_data.current_css&&jQuery("#"+tve_leads_page_data.current_css+"-css").remove(),tve_leads_page_data=jQuery.extend(tve_leads_page_data,a.tve_leads_page_data,!0),jQuery("#tl-form-states").html(a.state_bar),jQuery("#tve-leads-editor-replace").replaceWith(jQuery(a.main_page_content)),TVE_Content_Builder.controls.lb_close(),TVE_Editor_Page.initEditorActions();try{tve_init_sliders()}catch(b){console.log(b)}setTimeout(function(){TVE_Editor_Page.overlay("close")},1)},add:function(a){if(a.attr("data-subscribed"))return void alert(tve_leads_page_data.L.only_one_subscribed);var c=this;tve_save_post("true",function(){b.state_ajax({custom:"add",state:a.attr("data-state")}).done(jQuery.proxy(c.insertResponse,c))})},duplicate:function(a,c,d){if("already_subscribed"==a.attr("data-state"))return void alert(tve_leads_page_data.L.only_one_subscribed);var e=this;tve_save_post("true",function(){b.state_ajax({custom:"duplicate",id:a.attr("data-id")}).done(e.insertResponse)}),d.stopPropagation()},visibility:function(a,c,d){if(a.parents("li").hasClass("lightbox-step-active")&&"undefined"!=typeof a.attr("data-visible")){var e=this;b.state_ajax({custom:"visibility",visible:a.attr("data-visible")}).done(function(a){tve_add_notification(a.message),e.insertResponse(a)}),a.toggleClass("tve-icon-visible tve-icon-invisible"),d.stopPropagation()}},remove:function(a,c,d){if(!confirm(tve_leads_page_data.L.confirm_state_delete))return!0;var e=this;b.state_ajax({custom:"delete",id:a.attr("data-id")}).done(e.insertResponse),d.stopPropagation()},state_click:function(a){var b=this;tve_save_post("true",function(){b.display(a.attr("data-id"),!0)})},display:function(a){b.state_ajax({custom:"display",id:a}).done(jQuery.proxy(this.insertResponse,this))},toggle_manager:function(a){var c="addClass",d=2592e3,e=jQuery(".multistep-lightbox");a.attr("data-expand")&&(c="removeClass",d=-d),jQuery("body")[c]("tl-state-collapse"),b.set_cookie("tve_leads_state_collapse",1,d,"/"),e.css("display","")},toggle_add:function(a){a.toggleClass("tl-multistep-open")}}},a.fn.tve_leads_form=function(){var a=this;return{bgPattern:function(b){this.clearBgImage().clearBgColor(),a.css({"background-image":"url('"+b.find("input[data-image]").attr("data-image")+"')","background-repeat":"repeat","background-position":""})},clearBgImage:function(){return a.css({"background-image":"","background-repeat":"","background-size":"","background-position":""}),this},clearBgColor:function(){return a.tve_color_selector()&&tve_remove_css_rule(a.tve_color_selector(),"background-color"),a.css("background-color",""),this},bgImage:function(b){this.clearBgImage(),a.css({"background-image":"url('"+b.url+"')","background-repeat":"","background-size":"cover","background-position":"center center"})}}}}(jQuery);