/*! Thrive Leads - The ultimate Lead Capture solution for wordpress - 2015-09-24
* https://thrivethemes.com 
* Copyright (c) 2015 * Thrive Themes */
var TVE_Content_Builder=TVE_Content_Builder||{};!function(a){var b=".thrv_wrapper, p:not(.edit_mode, .thrv_custom_html_shortcode p, .wp-caption p), ul:not(ul.tve_clearfix), ol, h1, h2, h3, h4, h5, h6, address, pre, blockquote",c=".tve_no_drag, .thrive_leads_shortcode *, .tve_faqB *, .tve_wp_shortcode *, .thrv_bullets_shortcode ul, .thrv_tw_qs *, .thrv_post_grid *, .thrv_custom_html_shortcode *, .thrv_widget *, .thrv_widget_menu *, .tve_w_menu, .tve_w_menu *, .tve_lg_input_container *",d=".tve_colm, .tve_colm .tve_grt, .tve_cb div:not(.thrive-shortcode-config,.tve_dropzone), .tve_faqC, td, th, .fwi, .tve_content_inner, .thrv_content_reveal, .tve_scTC, .cck, .tve_empty_dropzone",e='<div class="tve_dropzone"></div>',f=null,g=null,h=-1!=navigator.userAgent.toLowerCase().indexOf("msie")?parseInt(navigator.userAgent.toLowerCase().split("msie")[1]):!1,i=null,j=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(b){return b||(b=window.event),c.call(a,b)})},k={init:function(){b=TVE_Content_Builder.apply_filters("sortable_elements",b),i=this.page_scroll("tcb_lightbox"===tve_path_params.post_type?"#tve-p-scroller":"body"),a("#tve_cpanel").on("click",".cp_draggable",function(){TVE_Editor_Page.enable(),k.fetch(a(this),k.get_dropzone())}),a(".cp_draggable").attr("draggable","true").each(function(){k.make_draggable(this)}),this.drop_forbid=a(".tve_drop_constraint");var c=a("body");c.on("mousemove",function(a){1!==a.which&&c.hasClass("tve-dragging")&&c.removeClass("tve-dragging")})},editorActions:function(){TVE_Editor_Page.editor.find(b).not(c).addClass("tve_draggable").attr("draggable","true").each(function(){k.make_draggable(this)}),this.refresh()},get_dropzone:function(){var b=a(".edit_mode"),c=a("#tve_editor");if(0!==b.length)return b.nextAll(".tve_dropzone").first();var d=c.find(".tve_editor_main_content");0===d.length&&(d=c);var e=d.first().children(".tve_dropzone");return e.length?e.last():(d.first().append('<div class="tve_dropzone" style="height:0px"></div>'),d.children(".tve_dropzone").last())},dragstart:function(b){var c=a(this),d=c.attr("data-elem");return a(".edit_mode").length?(b.preventDefault(),!1):(b.stopPropagation&&b.stopPropagation(),f=c.addClass("tve-dragged"),g=f.nextAll(".tve_dropzone").first(),setTimeout(function(){a("body").addClass("tve-dragging")},20),k.drop_forbid.removeClass("tve_drop_forbidden").each(function(){var b=a(this);f.is(b.attr("data-forbid"))&&b.addClass("tve_drop_forbidden")}),b.dataTransfer.effectAllowed="copy",void b.dataTransfer.setData("Text",d?d:"some_unique_id"+Math.random().toString()))},dragend:function(){a("body").removeClass("tve-dragging"),a(this).removeClass("tve-dragged"),f=null,i.hide()},dragenter:function(){a(this).addClass("tve_dragged_over")},dragover:function(a){return a.preventDefault&&a.preventDefault(),a.dataTransfer.dropEffect="copy",!1},dragleave:function(){a(this).removeClass("tve_dragged_over")},drop:function(b){var c=a(this);if(b.stopPropagation&&b.stopPropagation(),b.preventDefault&&b.preventDefault(),a("body").removeClass("tve-dragging"),f.removeClass("tve-dragged tve-draggable"),i.hide(),f.is("#tve_cpanel .cp_draggable"))k.fetch(f,c);else{if(c.is(a(".tve_dropzone",f)))return c.removeClass("tve_dragged_over"),!1;c.removeClass("tve_dragged_over"),tve_set_window_content_before_action(),g&&!g.is(c)&&g.remove(),c.replaceWith(f),k.ensure_dropzones(f),f.hasClass("thrv_social_default")&&TVE_Content_Builder.social.onDefaultDrop(f),tve_set_window_content_after_action()}return f=null,!1},bind_draggable:function(a){a.filter(b).not(c).addClass("tve_draggable").attr("draggable","true").each(function(){k.make_draggable(this)}),a.find(b).not(c).addClass("tve_draggable").attr("draggable","true").each(function(){k.make_draggable(this)})},make_draggable:function(b){j(b,"dragstart",k.dragstart),j(b,"dragend",k.dragend),h&&j(b,"selectstart",function(b){return a(".edit_mode").length?!0:(b.preventDefault&&b.preventDefault(),b.stopPropagation&&b.stopPropagation(),this.dragDrop&&this.dragDrop(),!1)})},refresh:function(d){"undefined"==typeof d&&(d=!1),d&&a("#tve_editor").find(b).not(c).addClass("tve_draggable").attr("draggable","true").each(function(){k.make_draggable(this)}),this.dropzones(),a(".tve_dropzone").each(function(){k.dropzone_events(this)})},dropzone_events:function(a){a.jquery&&(a=a[0]),j(a,"dragenter",this.dragenter),j(a,"dragover",this.dragover),j(a,"dragleave",this.dragleave),j(a,"drop",this.drop)},dropzones:function(){var f=TVE_Editor_Page.editor.css("min-height",TVE_Editor_Page.editor.height()+"px");a(".tve_dropzone").remove(),f.find(b).not(c).each(function(){var a=jQuery(this).after(e);(a.is(":first-child")||!a.prev().is(":visible"))&&a.before(e)}),f.find(d).each(function(){var b=a(this);a.trim(b.text())||0!==b.children(":visible").length||b.append(e)}),0===f.find("*:visible").length&&f.append(e),f.css("min-height",""),f=null},ensure_dropzones:function(f){f.is(b)&&!f.next().is(".tve_dropzone")&&(f.after(e),k.dropzone_events(f.next())),f.is(b)&&!f.prev().is(".tve_dropzone")&&(f.before(e),k.dropzone_events(f.prev())),f.find(b).not(c).each(function(){var b=a(this);b.prev().is(".tve_dropzone")||(b.before(e),k.dropzone_events(b.prev())),b.next().is(".tve_dropzone")||(b.after(e),k.dropzone_events(b.next()))}),f.is(d)&&!a.trim(f.text())&&0===f.children(":visible").length&&(f.prepend(e),k.dropzone_events(f.children().first()))},fetch:function(b,c){var d=b.find("input").serializeArray(),e=b.attr("data-elem"),f=b.attr("data-wpapi")?tve_path_params.ajax_url:tve_path_params.shortcodes_dir+e+".php";return this.before_fetch(e,b,c)===!1?!1:this.check_for_static_elements(e,c)?!0:-1===a.inArray(e+".php",tve_path_params.shortcodes_array)?!1:(b.attr("data-overlay")&&TVE_Editor_Page.overlay(),d.push({name:"colour",value:window.last_colour_used}),d.push({name:"cssdir",value:tve_path_params.editor_dir}),b.attr("data-wpapi")&&(d.push({name:"action",value:"tve_ajax_load"}),d.push({name:"ajax_load",value:e})),a.post(f,a.param(d),function(a){k.insert(a,c),TVE_Editor_Page.overlay("close")}),!1)},check_for_static_elements:function(a,b){var c=jQuery("#tve_static_elements").find("[data-elem='"+a+"']");if(c.length<=0)return!1;var d=c.first().clone();return d.find(".tve_red").removeClass("tve_red").addClass(window.last_colour_used),k.insert(d.html(),b),!0},before_fetch:function(a,b,c){return b.hasClass("user_template_item")?(this.load_template(jQuery.trim(b.find(".tpl_key").val()),c),!1):!0},after_fetch:function(a){a.hasClass("thrv_content_container_shortcode")?a.parent().addClass("tve_clearfix"):a.hasClass("thrv_countdown_timer")?a.hasClass("tve_countdown_timer_evergreen")?a.tve_countdown_timer_evergreen().update():a.tve_countdown_timer().update():a.find(".tve_vtabs").length?a.tve_tabs().resize():a.is(".thrv_lead_generation")?a.tve_lead_generation().applyStyle("thrv_lead_generation_vertical"):a.hasClass("thrv_social_default")&&TVE_Content_Builder.social.onDefaultInsert(a)},insert:function(b,c,d){"undefined"==typeof d&&(d=!1),a(".tve_dropzone").removeClass("tve_dragged_over"),tve_set_window_content_before_action();var e=a(b);return d?(c.html(e),e.hasClass("tve_table")&&(e=e.parent())):(c.replaceWith(e),e.find(".tve_dropzone").each(function(){k.dropzone_events(this)}),e.filter(".tve_dropzone").each(function(){k.dropzone_events(this)})),this.ensure_dropzones(e),this.bind_draggable(e),k.after_fetch(e),tve_set_window_content_after_action(),e},before_remove:function(a){a.next().is(".tve_dropzone")&&a.next().remove()},after_clone:function(a,b){b.find(".tve_dropzone").each(function(){k.dropzone_events(this)}),this.bind_draggable(b),this.ensure_dropzones(a),this.ensure_dropzones(b),b.hasClass("thrv_social_default")&&TVE_Content_Builder.social.onDefaultDrop(b)},load_template:function(b,c){var d={action:"tve_load_user_template",template_key:b,security:tve_path_params.tve_ajax_nonce,dataType:"json"};TVE_Editor_Page.overlay(),jQuery.post(tve_path_params.ajax_url,d,function(b){b=JSON.parse(b),a(".tve_dropzone").removeClass("tve_dragged_over"),tve_set_window_content_before_action();var d=a(b.html_code);d=tve_process_saved_template(b.css_code,d),c.replaceWith(d),k.bind_draggable(d),tve_set_window_content_after_action(),k.refresh(),TVE_Editor_Page.overlay("close")})},page_scroll:function(b){"undefined"==typeof b&&(b="body");var c=a('<div id="tve_page_scroller_top" class="tve_window_drag_scroll"><span class="tve_arrow tve_icm tve-ic-caret-up"></span><div class="tve_drag_events"></div></div>').appendTo(b),d=a('<div id="tve_page_scroller_bottom" class="tve_window_drag_scroll"><span class="tve_arrow tve_icm tve-ic-caret-down"></span><div class="tve_drag_events"></div></div>').appendTo(b),e=c.add(d),f=null,g=null,h=function(b,e){"undefined"==typeof e&&(e=!1);var f=c.parent();if(f.is("body")&&(f=a("body,html")),f.is(":animated"))return!0;var g=f.is("body")?a(window).scrollTop():f.scrollTop();return-1==b?(d.removeClass("tve_scroll_hide"),0===g?c.addClass("tve_scroll_hide").removeClass("tve_drag_hover"):c.removeClass("tve_scroll_hide")):(c.removeClass("tve_scroll_hide"),g+a(window).height()>=a("body").height()-45?d.addClass("tve_scroll_hide").removeClass("tve_drag_hover"):d.removeClass("tve_scroll_hide")),e||f.animate({scrollTop:g+120*b},80,"linear"),!0};return e.each(function(){var b=a(this),d=b.children(".tve_drag_events").get(0);j(d,"dragenter",function(){var b=a(this).parent(),d=b.is(c)?-1:1;clearInterval(g),f=d,g=setInterval(function(){h(d)},20),b.addClass("tve_drag_hover")}),j(d,"dragleave",function(b){clearInterval(g),a(this).parent().removeClass("tve_drag_hover")})}),h(-1,!0),{show:function(){e.show()},hide:function(){clearInterval(g),e.removeClass("tve_drag_hover tve_scroll_hide")}}}};TVE_Content_Builder.drag=k}(jQuery);