/*! Thrive Leads - The ultimate Lead Capture solution for wordpress - 2015-08-21
* https://thrivethemes.com 
* Copyright (c) 2015 * Thrive Themes */
var ThriveLeads=ThriveLeads||{};ThriveLeads.views=ThriveLeads.views||{},_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},jQuery(function(){var a=jQuery;a("body").on("click",".tve-leads-thickbox",function(){var b=a(this),c=b.data();"undefined"!=typeof c&&ThriveLeads.open_thickbox(b.attr("title")?b.attr("title"):b.text(),c)}),ThriveLeads.views.Base=Backbone.View.extend({render:function(){return this.$el.html(this.template(this.model.toJSON())),this},initialize:function(){this.listenTo(this.model,"change",this.render)}}),ThriveLeads.views.Group=ThriveLeads.views.Base.extend({tagName:"li",className:"collapse-table-list-item",template:_.template(ThriveLeads["const"].templates["groups/item"]),events:{"click .tve-group-delete":"deleteGroupPopup","click .tve-start-group-test":"startTest","click .tl-toggle-test-display":"toggleCollapsed","click .tve-group-details":function(a){this.model.set("details_expanded",!this.model.get("details_expanded"))},"click .tve-group-heading":function(a){var b=jQuery(a.target);b.hasClass("tve-prevent-click")||b.parents(".tve-prevent-click").length||this.model.set("details_expanded",!this.model.get("details_expanded"))},"click .tve-edit-title":"showEditTitleInput","change .tve-edit-title-input":"saveTitle","keyup .tve-edit-title-input":"saveTitleKeyup","blur .tve-edit-title-input":"closeEditTitle"},initialize:function(){this.listenTo(this.model,"change:details_expanded",this.groupDetails),this.listenTo(this.model,"change:impressions",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model.get("active_tests"),"add",this.render),this.listenTo(this.model.get("completed_tests"),"add",this.render),this.listenTo(this.model,"change:post_title",this.render)},render:function(){var a=!1,b=!1,c=this.model.toJSON();return c.running_tests_count=this.model.get("active_tests").length,c.archived_tests_count=this.model.get("completed_tests").length,this.$el.html(this.template(c)),this.model.get("form_types").each(this.addFormType,this),this.model.ableForTest()||this.$el.find(".tve-form-type-buttons").hide(),this.model.get("active_tests").length&&(a=!0,this.model.get("active_tests").each(this.renderActiveTest,this)),this.model.get("completed_tests").length&&(b=!0,this.model.get("completed_tests").each(this.renderCompletedTest,this)),this.$el.find(".tve-leads-running-tests")[a?"show":"hide"](),this.$el.find(".tve-leads-archived-tests")[b?"show":"hide"](),this.groupDetails(),this},startTest:function(){var a=this;this.$el.find("tr").removeClass("tve-form-no-content"),ThriveLeads.showLoader(),this.model.ajaxGetEmptyVariations().done(function(b){var c=b.ids?b.ids:[];a.model.get("form_types").each(function(a){-1!==jQuery.inArray(a.get("ID"),c)?a.set("has_design",!1):a.set("has_design",!0)}),ThriveLeads.open_thickbox(ThriveLeads["const"].translations.StartFormtypeTest+" "+ThriveLeads["const"].translations.StartGroupTestVideo,{view:"VariationTest",model:a.model,width:900,height:600}),ThriveLeads.objects.lightboxes.VariationTest.renderFormTypes()}).fail(function(a,b,c){}).always(function(){ThriveLeads.hideLoader()})},addFormType:function(a){var b=new ThriveLeads.views.FormType({model:a});this.$el.find(".tve-form-types > .tve-form-types-list").append(b.render().el)},deleteGroupPopup:function(b){var c=a(b.currentTarget);ThriveLeads.open_thickbox(c.attr("data-title"),{width:550,height:300,view:"ConfirmDeleteGroup",model:ThriveLeads.objects.groups.get(c.attr("data-id"))})},groupDetails:function(){this.model.get("details_expanded")?(this.$el.addClass("tve-expanded"),this.$el.find(".tve-form-types").slideDown("fast"),this.$el.find(".tve-group-details > span").attr("class","tve-icon-minus-circle")):(this.$el.removeClass("tve-expanded"),this.$el.find(".tve-form-types").slideUp("fast"),this.$el.find(".tve-group-details > span").attr("class","tve-icon-plus-circle"))},renderActiveTest:function(a){var b=this;a.set("type",[]),_.each(a.get("item_ids"),function(c){var d=b.model.get("form_types").findWhere({ID:parseInt(c)});d&&(d.set("group_test_id",a.get("id")),a.get("type").push(d.get("post_title")))});var c=new ThriveLeads.views.ActiveTestItem({model:a});this.$el.find("#tve-active-group-test-list").append(c.render().el)},renderCompletedTest:function(a){var b=this;a.set("type",[]),_.each(a.get("item_ids"),function(c){var d=b.model.get("form_types").findWhere({ID:parseInt(c)});a.get("type").push(d.get("post_title"))});var c=new ThriveLeads.views.CompletedTestItem({model:a});this.$el.find("#tve-completed-group-test-list").append(c.render().el)},toggleCollapsed:function(a){var b=jQuery(a.currentTarget),c=b.hasClass("collapsed");this.$el.find(""+b.data("target"))[c?"slideDown":"slideUp"](200),b.find("span.tl-icon").removeClass("tve-icon-expanded tve-icon-collapsed").addClass(c?"tve-icon-expanded":"tve-icon-collapsed"),b.toggleClass("collapsed"),b.toggleClass("hover")},showEditTitleInput:function(a){var b=this.$el.find(".group-title").hide();this.$el.find(".tve-edit-title-input").val(b.text()).show().focus().select(),jQuery(a.currentTarget).hide(),a.stopPropagation()},saveTitle:function(a){var b=a.currentTarget.value;b!=this.model.get("post_title")&&(this.model.set("post_title",b),this.model.save()),this.closeEditTitle()},saveTitleKeyup:function(a){(27==a.which||13==a.which)&&this.closeEditTitle()},closeEditTitle:function(){this.$el.find(".tve-edit-title-input").hide(),this.$el.find(".group-title,.tve-edit-title").show()}}),ThriveLeads.views.FormType=ThriveLeads.views.Base.extend({className:"tve-form-type-item",template:_.template(ThriveLeads["const"].templates["form-type/item"]),events:{"click .tve-form-type-add":"add","click .tve-form-type-mobile":"toggle_display","click .tve-form-type-status":"toggle_display","click .form-type-reset":"reset","click .tve-leads-php-code":"grabPHPCode"},initialize:function(){this.listenTo(this.model,"change:group_test_id",this.render),this.listenTo(this.model,"change:conversions",this.render),this.listenTo(this.model,"change:conversion_rate",this.render),this.listenTo(this.model,"change:impressions",this.render)},render:function(){return this.$el.html(this.template({form:this.model})),this},add:function(){var a=this;ThriveLeads.showLoader(),this.model.save({},{success:function(b,c){a.model.set("ID",c),ThriveLeads.router.navigate("#form-type/"+c,{trigger:!0})},complete:function(a){}})},save:function(){var a=this;this.model.save({},{success:function(b,c){a.model.set("ID",c)},complete:function(a){}})},toggle_display:function(a){var b=jQuery(a.currentTarget).is(":checked")?1:0,c=this.model.get("post_parent"),d=jQuery(a.target).attr("data-display"),e=jQuery(a.target).attr("data-title"),f=jQuery(a.currentTarget).parents(".tve-form-types").first().find("."+a.currentTarget.className+":checked").length,g=jQuery(a.currentTarget).parents(".tve-form-types").first().find("."+a.currentTarget.className).length;this.model.set(d,b),f===g?jQuery("#tve-"+e+"-"+c).html("Yes"):g>f&&f>0?jQuery("#tve-"+e+"-"+c).html("Custom"):0===f&&jQuery("#tve-"+e+"-"+c).html("No"),this.save()},reset:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.ResetFormStats,{view:"ConfirmFormTypeResetStats",model:this.model,width:600,height:300})},grabPHPCode:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.PHPInsertCode,{view:"PHPInsertCode",model:this.model,height:330})}}),ThriveLeads.views.FormVariation=ThriveLeads.views.Base.extend({tagName:"tr",className:"tve-variation-item",template:_.template(ThriveLeads["const"].templates["form-type/variation"]),events:{"click .variation-archive":"archive","click .variation-publish":"reAdd","click .variation-delete":"remove","click .variation-reset":"reset","click .variation-clone":"clone","click .tve-edit-title":"showEditTitleInput","change .tve-edit-title-input":"saveTitle","keyup .tve-edit-title-input":"saveTitleKeyup","blur .tve-edit-title-input":"closeEditTitle","click .tve-leads-display-frequency":"showFrequencyPopup","click .tve-leads-display-animation":"showAnimationPopup","click .tve-leads-lock-display":"showLockDisplayPopup"},has_frequency_settings:!1,has_position_settings:!1,has_animation_settings:!1,content_locking:!1,initialize:function(){this.listenTo(this.model,"change:post_title",this.render),this.listenTo(this.model,"change:impressions",this.render),this.listenTo(this.model,"change:conversions",this.render),this.listenTo(this.model,"change:display_frequency_nice_name",this.render),this.listenTo(this.model,"change:display_position_nice_name",this.render),this.listenTo(this.model,"change:display_animation_nice_name",this.render),this.listenTo(this.model,"change:content_locking",this.render)},render:function(){return this.model.set("has_frequency_settings",this.has_frequency_settings),this.model.set("has_position_settings",this.has_position_settings),this.model.set("has_animation_settings",this.has_animation_settings),this.model.set("content_locking",this.content_locking),this.model.set("has_trigger_settings",!(this.model instanceof ThriveLeads.models.TwoStepLightboxVariation)),this.$el.html(this.template(this.model.toJSON())),this},archive:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.ArchiveForm,{view:"ArchiveForm",model:this.model,width:500,height:200})},reset:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.ResetFormStats,{view:"ConfirmResetStats",model:this.model,width:600,height:300})},clone:function(a){ThriveLeads.showLoader();var b=this.model.toJSON();if(this.model instanceof ThriveLeads.models.ShortcodeVariation)var c=new ThriveLeads.models.ShortcodeVariation(_.extend({},b));else if(this.model instanceof ThriveLeads.models.TwoStepLightboxVariation)var c=new ThriveLeads.models.TwoStepLightboxVariation(_.extend({},b));else var c=new ThriveLeads.models.FormVariation(_.extend({},b));c.set("clone_from",c.get("key")),c.set("is_control",0),c.set("key","");var d=c.save({});ThriveLeads.addFailCallback(d),d.done(function(a){c.set(a)}).always(function(){d.failed||(c.unset("clone_from"),c instanceof ThriveLeads.models.ShortcodeVariation?(ThriveLeads.objects.Shortcode.get("variations").add(c),ThriveLeads.objects.Shortcode.trigger("change")):c instanceof ThriveLeads.models.TwoStepLightboxVariation?(ThriveLeads.objects.TwoStepLightbox.get("variations").add(c),ThriveLeads.objects.TwoStepLightbox.trigger("change")):(ThriveLeads.objects.FormType.get("variations").push(c),ThriveLeads.objects.FormType.trigger("change")),ThriveLeads.hideLoader())})},reAdd:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.ReAddForm+" "+this.model.get("post_title"),{view:"AddForm",model:new Backbone.Model({state:"re-add",group_id:Backbone.history.getFragment().match(/form-type/g)?ThriveLeads.objects.FormType.get("post_parent"):0,form_type_id:this.model.post_parent,form_variation:this.model}),height:230})},remove:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.DeleteForm,{view:"ConfirmDeleteVariation",model:this.model,width:520,height:260})},showEditTitleInput:function(a){var b=this.$el.find(".form-title").hide();this.$el.find(".tve-edit-title-input").val(b.text()).show().focus().select(),jQuery(a.currentTarget).hide()},saveTitle:function(a){var b=a.currentTarget.value;b!=this.model.get("post_title")&&(this.model.set("post_title",b),this.model.save()),this.closeEditTitle()},saveTitleKeyup:function(a){(27==a.which||13==a.which)&&this.closeEditTitle()},closeEditTitle:function(){this.$el.find(".tve-edit-title-input").hide(),this.$el.find(".form-title,.tve-edit-title").show()},showFrequencyPopup:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.DisplaySettings,{view:"DisplayFrequencySettings",model:this.model,width:600,height:300})},showAnimationPopup:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.AnimationSettings,{view:"AnimationSettings",model:this.model,width:600,height:290})},showLockDisplayPopup:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.LockDisplaySettings,{view:"LockDisplaySettings",model:this.model,width:600,height:290})}}),ThriveLeads.views.Dashboard=Backbone.View.extend({el:a("#tve-content"),template:_.template(a("#tve-leads-dashboard").length?a("#tve-leads-dashboard").html():""),globalSettings:null,initialize:function(a){this.globalSettings=a.globalSettings,this.has_non_uniques=a.has_non_uniques},events:{"click .report-item":"goToReporting"},goToReporting:function(){location.href=ThriveLeadsConst.url.reporting},render:function(){ThriveLeads.objects.titleChanger.replaceFirst("Thrive Leads Dashboard"),this.$el.html(this.template({globalSettings:this.globalSettings,has_non_uniques:this.has_non_uniques}));var b=new ThriveLeads.views.LeadGroups({el:this.$el.find("#tve-lead-groups"),collection:ThriveLeads.objects.groups}),c=new ThriveLeads.views.LeadShortcodes({el:this.$el.find("#tve-lead-shortcodes"),collection:ThriveLeads.objects.shortcodeCollection}),d=new ThriveLeads.views.TwoStepLightboxList({el:this.$el.find("#tve-two-step-lightbox"),collection:ThriveLeads.objects.TwoStepLightboxCollection}),e=ThriveLeads.objects.groups.getTotalVariations(),f=ThriveLeads.objects.shortcodeCollection.getTotalVariations(),g=ThriveLeads.objects.TwoStepLightboxCollection.getTotalVariations();b.renderAll(),c.render(),d.render(),e+f+g&&a("#no-form-overlay").hide(),ThriveLeads.displayMessages(".tve-header"),window.rebindWistiaFancyBoxes&&window.rebindWistiaFancyBoxes(),this.$el.find(".tl-open-settings,.tl-close-settings").on("click",_.bind(this.toggleGlobalSettings,this)),this.$el.find(".tve-setting-change").on("change",_.bind(this.globalSetting,this)),this.$el.find(".tve-leads-db-optimize").on("click",_.bind(this.optimizeDB,this))},optimizeDB:function(a){var b={action:"thrive_leads_backend_ajax",route:"optimizeDbAPI"};ThriveLeads.showLoader(),jQuery.post(ajaxurl,b,function(){jQuery(a.target).parents(".messagesList").remove(),ThriveLeads.addMessage({text:ThriveLeadsConst.translations.DbOptimized,status:"success"}),ThriveLeads.displayMessages(),ThriveLeads.hideLoader()}),this.has_non_uniques=!1},toggleGlobalSettings:function(a){return jQuery(a.currentTarget).parents(".tve-global-settings").toggleClass("tve-expanded"),!1},globalSetting:function(a){var b=jQuery(a.currentTarget),c={action:"thrive_leads_backend_ajax",route:"globalSettingsAPI",field:b.attr("name"),value:b.attr("value")};b.is('input[type="checkbox"]')&&!b.is(":checked")&&(c.value=0),this.globalSettings[c.field]=c.value,jQuery.post(ajaxurl,c)}}),ThriveLeads.views.LeadShortcodes=Backbone.View.extend({events:{"click .tve-add-shortcode":"openAddShortcode"},initialize:function(){this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.remove)},remove:function(){0==this.collection.length&&(this.$el.find(".tve-shortcode-list-header").hide(),this.$el.find(".no-shortcodes").show())},addOne:function(a){var b=new ThriveLeads.views.Shortcode({model:a,collection:this.collection});this.$el.find("#tve-shortcode-list").append(b.render().$el),this.$el.find(".tve-shortcode-list-header").show(),this.$el.find(".no-shortcodes").hide(),b.bindZclip()},render:function(){this.$el.find("#tve-shortcode-list").empty(),this.collection.each(this.addOne,this)},openAddShortcode:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.AddShortcode+" "+ThriveLeads["const"].translations.AddNewShortcodeVideo,{view:"AddShortcode",height:220})}}),ThriveLeads.views.Shortcode=Backbone.View.extend({tagName:"li",className:"collapse-table-list-item",template:_.template(ThriveLeads["const"].templates["shortcode/item"]),events:{"click .tve-shortcode-delete":"deleteShortcodePopup","click .shortcode-reset":"reset","click input.tve-shortcode":"selectAll","focus input.tve-shortcode":"selectAll","click .tve-shortcode-content-locking":"toggle_content_locking","click .tve-leads-php-code":"grabPHPCode"},initialize:function(){this.model.on("remove",this.remove,this),this.listenTo(this.model,"change:impressions",this.render)},remove:function(){this.$el.remove()},render:function(){return this.$el.html(this.template({shortcode:this.model})),this.$el.find(".tve-copy-code-container")["1"==this.model.get("content_locking")?"hide":"show"](),this},selectAll:function(a){jQuery(a.currentTarget).select()},bindZclip:function(){ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))},deleteShortcodePopup:function(b){var c=a(b.currentTarget);ThriveLeads.open_thickbox(c.attr("title"),{width:550,height:300,view:"ConfirmDeleteShortcode",model:ThriveLeads.objects.shortcodeCollection.get(c.attr("data-id"))})},toggle_content_locking:function(a){var b=jQuery(a.currentTarget).is(":checked")?1:0,c=this;this.model.set("content_locking",b),this.$el.find(".tve-copy-code-container")[b?"hide":"show"](),this.model.save({},{success:function(a,b){c.model.set("ID",b),c.model.set("shortcode_code",""),c.$el.find(".tve-shortcode-"+b).val(c.model.getCode())},complete:function(a){}})},reset:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.ResetFormStats,{view:"ConfirmFormTypeResetStats",model:this.model,width:600,height:300})},grabPHPCode:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.PHPInsertCode,{view:"PHPInsertCode",model:this.model,height:330})}}),ThriveLeads.views.TwoStepLightboxList=Backbone.View.extend({events:{"click .tve-add-two-step-lightbox":"openAddTwoStepLightbox"},initialize:function(){this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.remove)},remove:function(){0==this.collection.length&&(this.$el.find(".tve-two-step-lightbox-list-header").hide(),this.$el.find(".no-two-step-lightbox").show())},addOne:function(a){var b=new ThriveLeads.views.TwoStepLightboxItem({model:a,collection:this.collection});this.$el.find("#tve-two-step-lightbox-list").append(b.render().$el),this.$el.find(".tve-two-step-lightbox-list-header").show(),this.$el.find(".no-two-step-lightbox").hide(),b.bindZclip()},render:function(){this.$el.find("#tve-two-step-lightbox-list").empty(),this.collection.each(this.addOne,this)},openAddTwoStepLightbox:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.AddTwoStepLightbox+" "+ThriveLeads["const"].translations.AddNewTwoStepLightboxVideo,{view:"AddTwoStepLightbox",height:220})}}),ThriveLeads.views.TwoStepLightboxItem=Backbone.View.extend({tagName:"li",className:"collapse-table-list-item",template:_.template(ThriveLeads["const"].templates["two-step-lightbox/item"]),events:{"click .tve-two-step-lightbox-delete":"deleteTwoStepLightboxPopup","click input.tve-two-step-lightbox":"selectAll","focus input.tve-two-step-lightbox":"selectAll","click .two-step-reset":"reset"},initialize:function(){this.model.on("remove",this.remove,this),this.listenTo(this.model,"change:impressions",this.render)},remove:function(){this.$el.remove()},render:function(){return this.$el.html(this.template({two_step_lightbox:this.model})),this},selectAll:function(a){jQuery(a.currentTarget).select()},bindZclip:function(){ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard"))},deleteTwoStepLightboxPopup:function(b){var c=a(b.currentTarget);ThriveLeads.open_thickbox(c.attr("title"),{width:550,height:300,view:"ConfirmDeleteTwoStepLightbox",model:ThriveLeads.objects.TwoStepLightboxCollection.get(c.attr("data-id"))})},reset:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.ResetFormStats,{view:"ConfirmFormTypeResetStats",model:this.model,width:600,height:300})}}),ThriveLeads.views.LeadGroups=Backbone.View.extend({events:{"click .tve-add-group":"openAddGroup"},viewItems:[],initialize:function(){this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne)},removeOne:function(){0===this.collection.length&&(this.$el.find(".hide-no-groups").hide(),this.$el.find(".show-no-groups").show())},addOne:function(a){a.get("active_tests")instanceof Backbone.Collection||a.set("active_tests",new ThriveLeads.collections.Tests(a.get("active_tests"))),a.get("completed_tests")instanceof Backbone.Collection||a.set("completed_tests",new ThriveLeads.collections.Tests(a.get("completed_tests"))),this.$el.find(".hide-no-groups").show(),this.$el.find(".show-no-groups").hide();var b=new ThriveLeads.views.Group({model:a});this.$el.find("#tve-group-list").append(b.render().$el),this.viewItems.push(b)},addAll:function(a){this.viewItems=[],this.$el.find("#tve-group-list").empty(),a.each(this.addOne,this)},render:function(){this.collection.length?(this.$el.find(".hide-no-groups").show(),this.$el.find(".show-no-groups").hide()):(this.$el.find(".hide-no-groups").hide(),this.$el.find(".show-no-groups").show());var a=this;return this.$el.find("#tve-group-list").sortable({placeholder:"ui-sortable-placeholder",handle:".tve-sort-handle",axis:"y",update:function(b,c){a.updateOrder()},start:function(a,b){b.item.removeClass("tve-expanded").find(".tve-form-types").hide()}}),this},updateOrder:function(){var a={};_.each(this.viewItems,function(b){b.model.get("order")!=b.$el.index()&&(b.model.set("order",b.$el.index()),a[b.model.get("ID")]=b.$el.index())}),this.collection.sort(),jQuery.ajax({type:"post",url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"groupAPI",custom:"update_order",new_order:a}})},renderAll:function(){this.addAll(this.collection),this.render()},openAddGroup:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.AddGroup+" "+ThriveLeads["const"].translations.AddNewGroupVideo,{view:"AddGroup",height:220})}}),ThriveLeads.views.FormTypeEdit=Backbone.View.extend({el:a("#tve-content"),template:_.template(ThriveLeads["const"].templates["form-type/edit"]),events:{"click .tve-add-form":"addFormPopup","click .tve-start-variation-test":"startVariationTestPopup","click input.tve-shortcode":"selectAll","focus input.tve-shortcode":"selectAll","click .tl-toggle-display":"toggleCollapsed","click .tve-leads-main-php-code":"grabPHPCode"},initialize:function(){this.listenTo(this.model,"change",this.render)},clear:function(){this.$el.html(""),this.delegateEvents()},selectAll:function(a){jQuery(a.currentTarget).select()},grabPHPCode:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.PHPInsertCode,{view:"PHPInsertCode",model:this.model,height:330})},render:function(){return ThriveLeads.objects.titleChanger.replaceFirst(this.model.get("post_title")),this.FLAG_skipListener?void delete this.FLAG_skipListener:(this.$el.html(this.template({model:this.model})),this.toggleLogic(),this.addPublished(this.model.get("variations")),this.addArchived(this.model.get("variations_archived")),this.addCompletedTests(this.model.get("completed_tests")),this.displayDetailsOfGroupModel(),ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard")),ThriveLeads.displayMessages(".tve-header"),void ThriveLeads.hideLoader())},toggleLogic:function(){0===this.model.get("variations").length&&0===this.model.get("variations_archived").length&&0===this.model.get("completed_tests").length?(this.$el.find(".tl-show-no-forms").show(),this.$el.find(".tl-hide-no-forms").hide()):(this.$el.find(".tl-show-no-forms").hide(),this.$el.find(".tl-hide-no-forms").show()),this.model.get("variations").length?(this.$el.find(".hide-no-groups").show(),this.$el.find(".show-no-groups").hide()):(this.$el.find(".hide-no-groups").hide(),this.$el.find(".show-no-groups").show()),this.$el.find("#tl-completed-tests")[this.model.get("completed_tests").length?"show":"hide"](),this.$el.find("#tl-archived-forms")[this.model.get("variations_archived").length?"show":"hide"](),window.rebindWistiaFancyBoxes&&window.rebindWistiaFancyBoxes()},displayDetailsOfGroupModel:function(){try{var a=ThriveLeads.objects.groups.findWhere({ID:this.model.get("post_parent")});a&&a.set("details_expanded",!0)}catch(b){console.log(b.message)}},addPublishedItem:function(a){var b=new ThriveLeads.views.FormVariation({model:a,collection:this.model.get("variations")});b.has_frequency_settings=this.model.get("has_frequency_settings"),b.has_position_settings=this.model.get("has_position_settings"),b.has_animation_settings=this.model.get("has_animation_settings"),b.content_locking=this.model.get("content_locking"),this.$el.find("#tve-variation-list").append(b.render().el)},addPublished:function(a){if(this.$el.find("#tve-variation-list").empty(),!(a.length<=0)){a.each(this.addPublishedItem,this),a.length>1&&1===this.$el.find(".tve-start-variation-test").length&&this.$el.find(".tve-start-variation-test").show();try{if(this.model.get("post_type")===ThriveLeads["const"].tve_leads_post_form_type){var b=ThriveLeads.objects.groups.findWhere({ID:this.model.get("post_parent")}).get("form_types").findWhere({ID:this.model.get("ID")}).get("variations");b.reset(this.model.get("variations").toJSON())}}catch(c){console.log(c.message)}}},addArchivedItem:function(a){var b=new ThriveLeads.views.FormVariation({model:a});b.has_frequency_settings=this.model.get("has_frequency_settings"),b.has_position_settings=this.model.get("has_position_settings"),b.has_animation_settings=this.model.get("has_animation_settings"),b.content_locking=this.model.get("content_locking"),this.$el.find("#tve-archive-list").append(b.render().el)},addArchived:function(a){a.length<=0||(this.$el.find("#tve-archive-list").empty(),a.each(this.addArchivedItem,this))},addCompletedTestItem:function(a){var b=new ThriveLeads.views.CompletedTestItem({model:a});this.$el.find("#tve-completed-test-list").append(b.render().el)},addCompletedTests:function(a){a.length<=0||(this.$el.find("#tve-completed-test-list").empty(),a.each(this.addCompletedTestItem,this))},addFormPopup:function(a){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.AddNewForm+" "+ThriveLeads["const"].translations.AddNewFormVideo,{view:"AddForm",model:new Backbone.Model({state:"add",form_type_id:this.model.get("ID"),group_id:this.model.get("post_parent"),form_variation:{},post_type:this.model.get("post_type"),content_locking:this.model.get("content_locking")}),height:230})},markRowErrors:function(a){var b=this;_.each(a,function(a){b.$el.find("#variation-key-"+a).parents("tr").first().addClass("tve-form-no-content")})},startVariationTestPopup:function(a){var b=this;this.$el.find("tr").removeClass("tve-form-no-content"),ThriveLeads.showLoader(),this.model.ajaxGetEmptyVariations().done(function(a){var c=a.ids?a.ids:[];return c.length?(ThriveLeads.addMessage({text:ThriveLeads["const"].translations.MissingFormContent,status:"error"}),ThriveLeads.displayMessages(),void b.markRowErrors(c)):void ThriveLeads.open_thickbox(ThriveLeads["const"].translations.StartVariationTest+" "+ThriveLeads["const"].translations.StartVariationTestVideo,{view:"VariationTest",model:b.model,width:600,height:400})}).fail(function(a,b,c){}).always(function(){ThriveLeads.hideLoader()})},toggleCollapsed:function(a){var b=jQuery(a.currentTarget),c=b.hasClass("collapsed");this.$el.find(""+b.data("target"))[c?"slideDown":"slideUp"](200),b.find("span.tl-icon").removeClass("tve-icon-expanded tve-icon-collapsed").addClass(c?"tve-icon-expanded":"tve-icon-collapsed"),b.toggleClass("collapsed"),b.toggleClass("hover")}}),ThriveLeads.views.Test=Backbone.View.extend({el:a("#tve-content"),template:_.template(ThriveLeads["const"].templates["tests/view"]),render:function(){var a=this;if(ThriveLeads.objects.titleChanger.replaceFirst(this.model.get("title")),this.$el.html(this.template({test:this.model})),this.renderItems(),this.renderChart(),this.model.get("status")===ThriveLeads["const"].test_status.running&&this.renderOptions(),this.model.get("test_type")===ThriveLeads["const"].group_test_type)this.displayDetailsOfGroupModel(this.model.get("main_group_id"));else{var b=this.model.get("items").first().get("main_group_id");this.displayDetailsOfGroupModel(b)}window.rebindWistiaFancyBoxes&&window.rebindWistiaFancyBoxes(),void 0!==this.collection&&this.collection instanceof ThriveLeads.collections.Tests&&(this.listenTo(this.collection,"add",this.addCompletedTestItem),this.collection.fetch({url:ajaxurl+"?action=thrive_leads_backend_ajax&route=completedTests&id="+this.model.get("main_group_id"),success:function(){a.$el.find("#tl-completed-tests-count").html("("+a.collection.length+")"),0===a.collection.length&&a.$el.find("#tl-toggle-completed-tests").html('<p style="margin: 0; padding-left: 27px">'+ThriveLeadsConst.translations.NoTestCompleted+"</p>"),a.$el.find("#tl-completed-tests").slideDown(200)}}),this.$el.find(".tl-toggle-completed-tests").on("click",_.bind(this.toggleCollapsed,this)))},addCompletedTestItem:function(a){var b=new ThriveLeads.views.CompletedTestItem({model:a});this.$el.find("#tve-completed-test-list").append(b.render().el)},renderOptions:function(){var a=new ThriveLeads.views.TestOptions({model:this.model,collection:this.model.get("items"),el:this.$el.find("#tve-test-options")});a.render()},renderChart:function(){var a=new ThriveLeads.models.TestChartModel({ID:this.model.get("id"),start_date:this.model.get("date_started"),interval:"day"}),b=new ThriveLeads.views.TestChartView({model:a,el:this.$el.find(".tve-chart-interval")});b.drawCandleStick(this.model.get("items")),a.fetch()},renderItems:function(){if(this.model.get("items")&&!(this.model.get("items").length<=0)){this.model.get("items")instanceof Backbone.Collection||this.model.set("items",new ThriveLeads.collections.TestItems(this.model.get("items"))),this.displayNoDataOverlay(this.model.get("items"));var a=new ThriveLeads.views.TestItemList({model:this.model,collection:this.model.get("items"),el:this.$el.find("#tve-form-test-items")});a.render();var b=new ThriveLeads.views.TestItemsTotals({model:this.model,collection:this.model.get("items"),el:this.$el.find("#tve-test-items-total")});b.render()}},displayDetailsOfGroupModel:function(a){try{var b=ThriveLeads.objects.groups.findWhere({ID:parseInt(a)});b&&b.set("details_expanded",!0)}catch(c){console.log(c.message)}},displayNoDataOverlay:function(a){var b=!0;a.each(function(a){return parseInt(a.get("unique_impressions"))>0?void(b=!1):void 0}),b?this.$el.find(".tve-chart-overlay").show():this.$el.find(".tve-chart-overlay").hide()},toggleCollapsed:function(a){var b=jQuery(a.currentTarget),c=b.hasClass("collapsed");this.$el.find(""+b.data("target"))[c?"slideDown":"slideUp"](200),b.find("span.tl-icon").removeClass("tve-icon-expanded tve-icon-collapsed").addClass(c?"tve-icon-expanded":"tve-icon-collapsed"),b.toggleClass("collapsed"),b.toggleClass("hover")}}),ThriveLeads.views.CompletedTestItem=Backbone.View.extend({tagName:"tr",template:_.template(ThriveLeads["const"].templates["tests/completed-test-item"]),render:function(){return this.$el.html(this.template({test:this.model})),this}}),ThriveLeads.views.ActiveTestItem=Backbone.View.extend({tagName:"tr",template:_.template(ThriveLeads["const"].templates["tests/active-test-item"]),render:function(){return this.$el.html(this.template({test:this.model})),this}}),ThriveLeads.views.TestChartView=Backbone.View.extend({events:{"change #tve-chart-interval-select":"intervalChanged"},initialize:function(){this.createChart();var a=this;this.listenTo(this.model,"change:interval",function(){a.model.fetch()}),this.listenTo(this.model,"change",this.updateChart)},intervalChanged:function(){"undefined"!=typeof this.chart&&this.chart.showLoading();var b=a("#tve-chart-interval-select").val();this.model.set("interval",b)},updateChart:function(){this.chart.set("data",this.model.get("chart_data")),this.chart.set("title",this.model.get("chart_data")),this.chart.set("x_axis",this.model.get("chart_x_axis")),this.chart.set("y_axis",this.model.get("chart_y_axis")),this.chart.redraw()},createChart:function(){this.chart=new ThriveLeads.LineChart({title:"",data:[],renderTo:"tve-test-chart"}),this.chart.showLoading()},drawCandleStick:function(a){if(a){var b=a.getCandleStickData();this.bar_chart=new ThriveLeads.BarChart({
title:"",data:b.chartData,colors:b.chartColors,renderTo:"tve-candle-stick-chart"})}}}),ThriveLeads.views.TestItemList=Backbone.View.extend({addOne:function(a,b){a.set("show_graph",!0),a.set("index",b),a.set("parent_test_running",this.model.isRunning());var c=ThriveLeads["const"].CHART_COLORS[b%ThriveLeads["const"].CHART_COLORS.length];a.set("color",c);var d=new ThriveLeads.views.TestItem({model:a});this.$el.append(d.render().el)},addAll:function(a){a.each(this.addOne,this)},render:function(){return this.addAll(this.collection),this}}),ThriveLeads.views.TestItem=Backbone.View.extend({tagName:"tr",template:_.template(ThriveLeads["const"].templates["tests/item"]),initialize:function(a){this.highest_id=a.highest_id},render:function(){return this.$el.html(this.template({item:this.model})),this.highest_id===this.model.get("id")&&this.$el.addClass("highlight"),this}}),ThriveLeads.views.TestItemsTotals=Backbone.View.extend({events:{"click .tve-edit-test":"editTest"},tagName:"tr",template:_.template(ThriveLeads["const"].templates["tests/totals"]),initialize:function(){this.listenTo(this.model,"auto_win_changed",_.bind(this.render,this))},render:function(){this.$el.html(this.template({totals:this.collection.getTotals(),test:this.model}))},editTest:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.AutomaticWinnerSettings,{view:"EditVariationTest",model:this.model})}}),ThriveLeads.views.TestOptions=Backbone.View.extend({template:_.template(ThriveLeads["const"].templates["tests/options"]),events:{"click .tve-stop-test":"stopTest"},stopTest:function(){ThriveLeads.open_thickbox(ThriveLeads["const"].translations.ChooseWinner,{width:1230,view:"StopVariationTest",model:this.model,collection:this.collection}),ThriveLeads.objects.lightboxes.StopVariationTest.renderTestItems()},render:function(){this.$el.append(this.template(this.model.toJSON()))}}),ThriveLeads.views.FiltersView=ThriveLeads.views.Base.extend({className:"tve_leads_filtersContainer",events:{"click .tve_leads_tabFilter":function(a){this.filterClicked(jQuery(a.target))}},initialize:function(){},render:function(){var a=this;_.each(this.collection.models,function(b){a.renderFilter(b)})},renderFilter:function(a){var b=_.template(ThriveLeads["const"].templates["groups/settings/filter"],a.toJSON());this.$el.append(b)},filterClicked:function(a){_.each(this.$el.parent().find(".tve_leads_optionContainer,.tve_leads_tab_content_toggle"),function(b){var c=jQuery(b);c.children("label").data("type")===a.attr("id")?c.show():c.hide()}),this.renderSelectedFilter(a.text())},renderSelectedFilter:function(a){var b=this.$el.next(".tve_leads_selectedFilter");b.length&&b.remove();var c=_.template(ThriveLeads["const"].templates["groups/settings/selected_filter"],{filter:a});this.$el.after(c)}}),ThriveLeads.views.OptionView=ThriveLeads.views.Base.extend({className:"tve_leads_optionContainer",events:{"click .tve_leads_toggle_option":"toggle","click .tve_leads_removeDirectLink":"removeLink"},initialize:function(){this.listenTo(this.model,"change:isChecked",this.isCheckedChanged)},render:function(){if("direct_url"===this.model.get("type"))var a=_.template(ThriveLeads["const"].templates["groups/settings/direct_url"],this.model.toJSON());else var a=_.template(ThriveLeads["const"].templates["groups/settings/option"],this.model.toJSON());this.$el.append(a)},toggle:function(){this.model.toggle()},isCheckedChanged:function(){this.$el.find('input[type="checkbox"]').prop("checked",this.model.get("isChecked"))},removeLink:function(){this.model.collection.remove(this.model)}}),ThriveLeads.views.tab_custom_views={_autocomplete:function(a,b,c){a.autocomplete({minLength:2,delay:200,source:function(a,c){jQuery.ajax({url:ajaxurl,dataType:"json",data:{action:"thrive_leads_backend_ajax",route:b,q:a.term,tax:"post_tag"}}).done(function(a){c(a)})},select:c})},taxonomy_terms:Backbone.View.extend({template:_.template(ThriveLeads["const"].templates["groups/settings/tags_filter"]),render:function(a){var b=this;return this.$el.html(this.template(this.model.attributes)),this.$el.addClass("tve_leads_tab_content_toggle").hide(),ThriveLeads.views.tab_custom_views._autocomplete(this.$el.find(".tve-leads-autocomplete"),"tagSearch",function(a,c){return b.model.get("options").add({isChecked:!0,type:"post_tag",id:c.item.id,label:c.item.label}),this.value="",!1}),a.find(".tve_leads_selectedFilter").after(this.$el),this}}),posts:Backbone.View.extend({template:_.template(ThriveLeads["const"].templates["groups/settings/posts_filter"]),render:function(a){var b=this;this.$el.html(this.template(this.model.attributes)),ThriveLeads.views.tab_custom_views._autocomplete(this.$el.find(".tve-leads-autocomplete"),"postSearch",function(a,c){return b.model.get("options").add({isChecked:!0,type:"",id:c.item.id,label:c.item.label}),this.value="",!1}),a.find("h2").after(this.$el)}})},ThriveLeads.views.TabContentView=ThriveLeads.views.Base.extend({actionContainerClass:"tve_leads_actionContainer",actionDefaultClass:"tve_leads_tabAction",events:{"click .selectAll":"checkAll","click .selectNone":"checkNone","click .tve_leads_addDirectLink":"addDirectLinkClicked","keypress .tve_leads_directUrl":"addDirectLinkClicked"},initialize:function(){this.listenTo(this.model.get("options"),"add",function(a){this.renderOptions(a.get("type")),this.model.trigger("change")}),this.listenTo(this.model.get("options"),"remove",function(){this.renderOptions(),this.model.trigger("change")})},renderOthersTab:function(){this.$el.addClass(this.model.getTabContentIdentifier()).addClass("tve_leads_tabs_content").addClass("tve_leads_clearfix").append("<h2>Visitor Status</h2>").append('<div class="tl-visitor-status clearfix"></div>').append('<div class="clear"></div><h2>Direct URLs</h2>').append('<div class="tl-direct-urls tve_leads_tab_content_direct_urls clearfix"></div>'),this.renderOptionsOthers(),this.renderAddDirectUrlForm()},renderOptionsOthers:function(){this.$el.find(".tl-visitor-status").empty(),this.$el.find(".tl-direct-urls").empty();var a=this;_.each(this.model.get("options").models,function(b){var c="direct_url"==b.get("type")?a.$el.find(".tl-direct-urls"):a.$el.find(".tl-visitor-status"),d=new ThriveLeads.views.OptionView({model:b});c.append(d.el),d.render(),b.on("change:isChecked",function(){a.model.trigger("change")})})},render:function(){return"others"===this.model.get("identifier")?this.renderOthersTab():(this.$el.addClass(this.model.getTabContentIdentifier()).addClass("tve_leads_tabs_content").addClass("tve_leads_clearfix").append("<h2>"+this.model.get("label")+"</h2>"),this.renderActions(),this.renderOptions(),this.renderFilters(),void this.renderCustomHtml())},renderCustomHtml:function(){if(ThriveLeads.views.tab_custom_views[this.model.get("identifier")]){var a=new(ThriveLeads.views.tab_custom_views[this.model.get("identifier")])({model:this.model});a.render(this.$el)}},renderOptions:function(a){if("others"===this.model.get("identifier"))return this.renderOptionsOthers();this.$el.find(".tve_leads_optionContainer").remove();var b=this;_.each(this.model.get("options").models,function(c){b.renderOption(c,a),c.on("change:isChecked",function(){b.model.trigger("change")})})},renderOption:function(a,b){var c=new ThriveLeads.views.OptionView({model:a});this.$el.append(c.el),c.render(),b&&a.get("type")!=b&&c.$el.hide()},renderActions:function(){if(this.model.get("actions").length){var a=jQuery('<div class="'+this.actionContainerClass+' tve_leads_clearfix" />'),b=this;this.$el.append(a),this.model.get("actions").length&&_.each(this.model.get("actions"),function(a){b.$el.find("."+b.actionContainerClass).append('<a class="'+b.actionDefaultClass+" "+a.cssClass+'" href="javascript:void(0)">'+a.label+"</a>")})}},renderFilters:function(){if(this.model.get("filters").length){var a=new ThriveLeads.views.FiltersView({model:this.model,collection:this.model.get("filters")});a.render(),this.$el.find("h2").after(a.el),a.filterClicked(a.$el.children().first())}},renderAddDirectUrlForm:function(){var a=_.template(ThriveLeads["const"].templates["groups/settings/add_direct_url_form"]);this.$el.append(a)},checkAll:function(){_.each(this.model.get("options").models,function(a){a.check()})},checkNone:function(){_.each(this.model.get("options").models,function(a){a.uncheck()})},addDirectLinkClicked:function(a){if("keypress"!==a.type||13===a.which){var b=jQuery(a.target),c=b.parent(),d=c.find("input");this.model.get("options").add({id:d.val().trim(),label:d.val().trim(),type:"direct_url"},{validate:!0}),d.val("")}}}),ThriveLeads.views.TabLabelView=ThriveLeads.views.Base.extend({template:_.template(ThriveLeads["const"].templates["groups/settings/tab_label"]),activeClass:"tve_leads_active_tab",tagName:"li",events:{click:"activate"},render:function(){this.$el.html(this.template({tab:this.model})),this.$el.attr("id",this.model.getTabIdFromIdentifier())},activate:function(){this.model.set({isActive:!0})}}),ThriveLeads.views.HangerView=ThriveLeads.views.Base.extend({template:_.template(ThriveLeads["const"].templates["groups/settings/hanger"]),initialize:function(){},render:function(){var a=this.template(this.model.toJSON()),b=this;this.$el.html(a),this.$tabLabelsContainer=this.$el.find(".tve_leads_tabs"),this.$tabContentsContainer=this.$el.find(".tve_leads_tabs_content_wrapper"),_.each(this.model.get("tabs").models,function(a){var c=b.renderTabLabels(a),d=b.renderTabContent(a);a.on("change:isActive",_.bind(b.activateTab,b,c,d)),a.on("change",_.bind(function(){"hide_group_options"===this.model.get("identifier")?jQuery("#exclusions-count").html("("+this.model.countCheckedOptions()+")"):jQuery("#inclusions-count").html("("+this.model.countCheckedOptions()+")")},b,a))}),this.model.get("tabs").at(0).set("isActive",!0)},renderTabLabels:function(a){var b=new ThriveLeads.views.TabLabelView({model:a});return this.$tabLabelsContainer.append(b.el),b.render(),b},renderTabContent:function(a){var b=new ThriveLeads.views.TabContentView({model:a});return this.$tabContentsContainer.append(b.el),b.render(),b},activateTab:function(a,b,c,d){this.$tabLabelsContainer.find("li").removeClass(a.activeClass),this.$tabContentsContainer.find(".tve_leads_tabs_content").hide(),a.$el.addClass(a.activeClass),b.$el.show(),c.attributes.isActive=!1}}),ThriveLeads.views.DisplayGroupSettings=ThriveLeads.views.Base.extend({el:"#TB_window #TB_ajaxContent",template:_.template(ThriveLeads["const"].templates["groups/settings/group_settings"]),events:{"click .tve_leads_save_widget_options":"saveOptions","click .tve_leads_add_new_template":"saveTemplate","click .tve_leads_load_saved_options":"loadTemplate","click .tve-close-thickbox":"closeThickbox","click .tl-toggle-display":"toggleCollapsed"},initialize:function(){},render:function(){var a=ThriveLeads.objects.groups.get(parseInt(this.group));ThriveLeads.objects.titleChanger.replaceFirst(a.get("post_title")+" "+ThriveLeads["const"].translations.DisplayGroupSettings),this.$el.parent().addClass("TB_Wide"),this.$el.html(this.template()),this.$templatesList=this.$el.find(".tve_leads_saved_options");var b=this;_.each(this.collection.models,function(a){b.renderHangerView(a)}),this.renderTemplatesList()},closeThickbox:function(){tb_remove()},renderHangerView:function(a){var b=new ThriveLeads.views.HangerView({model:a,el:jQuery("#"+a.get("identifier"))});b.render()},renderTemplatesList:function(){var b=this;this.$templatesList.find("option").each(function(b){b>0&&a(this).remove()}),_.each(ThriveLeads.objects.savedTemplates.models,function(a){b.$templatesList.append('<option value="'+a.get("id")+'">'+a.get("name")+"</option>")})},loadTemplate:function(){if("0"===this.$templatesList.val())return this.collection=ThriveLeads.objects.hangers,void this.render();var a=ThriveLeads.objects.savedTemplates.findWhere({id:this.$templatesList.val()}),b=this;ThriveLeads.showLoader(),jQuery.ajax({url:ajaxurl,data:{action:"thrive_leads_backend_ajax",route:"loadGroupTemplate",group:this.group,template_id:this.$templatesList.val()}}).done(function(c){b.collection.reset(c),b.render(),b.displayMessage(a.get("name")+" "+ThriveLeads["const"].translations.DisplaySettingsTemplateLoaded,function(){ThriveLeads.hideLoader()}),ThriveLeads.hideLoader()})},displayMessage:function(a,b,c){"undefined"==typeof c&&(c="updated");var d=this.$el.find("#tve-message-container");d.html('<div class="'+c+'"><p>'+a+"</p></div>"),d.slideDown(200,function(){setTimeout(function(){d.slideUp(200,function(){d.html("")})},6e3)}),b&&b.call()},saveOptions:function(b){var c={options:[JSON.stringify(this.collection.at(0).getDataForSave()),JSON.stringify(this.collection.at(1).getDataForSave())],group:this.group},d=a(b.target),e=d.html(),f=this;d.html("Saving...").attr("disabled",!0),a.ajax({url:this.urlSaveOptions,type:"post",dataType:"json",data:c,success:function(a){return a.success?(_.each(ThriveLeads.objects.groups.models,function(a){return a.get("ID")==f.group?void a.set("has_display_settings",1):void 0}),void f.closeThickbox()):void f.displayMessage(a.message?a.message:ThriveLeads["const"].translations.GeneralError,function(){f.$el.scrollTop(0)},"error")},error:function(a,b,c){f.displayMessage(ThriveLeads["const"].translations.GeneralError+" ( Error info: <strong>"+c+"</strong> )",function(){f.$el.scrollTop(0)},"error")},complete:function(){d.html(e).attr("disabled",!1)}})},saveTemplate:function(b){var c=a("input[name='tve_leads_new_template_name']"),d=this;if(!c.val().trim().length)return void alert(ThriveLeads["const"].translations.PleaseSelectANameForYourTemplate);var e={name:c.val().trim(),options:[JSON.stringify(this.collection.at(0).getDataForSave()),JSON.stringify(this.collection.at(1).getDataForSave())]},f=!1;_.each(ThriveLeads.objects.savedTemplates.models,function(a){a.get("name")===e.name&&(f=!confirm('"'+e.name+'" template already exists. Do you want to overwrite it ?'))}),f||(ThriveLeads.showLoader(),a.ajax({type:"post",dataType:"json",data:e,url:this.urlSaveTemplate,success:function(b){return b.success?(c.val(""),ThriveLeads.objects.savedTemplates=new ThriveLeads.collections.Templates(b.templates),d.renderTemplatesList(),d.$templatesList.find("option").each(function(){a(this).text()===e.name&&a(this).attr("selected","selected")}),void d.displayMessage(ThriveLeads["const"].translations.DisplaySettingsTemplateSaved,function(){d.$el.scrollTop(0)})):void d.displayMessage(b.message?b.message:ThriveLeads["const"].translations.GeneralError,function(){d.$el.scrollTop(0)},"error")},error:function(a,b,c){d.displayMessage(ThriveLeads["const"].translations.GeneralError+" ( Error info: <strong>"+c+"</strong> )",function(){d.$el.scrollTop(0)},"error")},complete:function(){ThriveLeads.hideLoader()}}))},toggleCollapsed:function(a){var b=jQuery(a.currentTarget),c=b.hasClass("collapsed");this.$el.find(""+b.data("target"))[c?"slideDown":"slideUp"](200),b.find("span.tl-icon").removeClass("tve-icon-expanded tve-icon-collapsed").addClass(c?"tve-icon-expanded":"tve-icon-collapsed"),b.toggleClass("collapsed"),b.toggleClass("hover")}});var b=Backbone.View.extend({events:{"click .tve-close-thickbox":"closeThickbox"},initialize:function(){_.extend(this.events,b.prototype.events)},afterOpen:function(){},closeThickbox:function(){this.$el.find(".tve-loading").removeClass("tve-loading").removeAttr("disabled"),tb_remove(),this.clearData()},exists:function(){return this.$el.parents("body").length},getId:function(){return"tve-lightbox-"+this.cid},render:function(){var a=this.model&&this.model.toJSON?this.model.toJSON():{};a.model_instance=this.model;var b=this.template(a);return this.$el.attr("id",this.getId()).html("<div>"+b+"</div>"),this},btnLoading:function(a){return jQuery(a).addClass("tve-loading").attr("disabled","disabled")},clearData:function(){},resize:function(){ThriveLeads.resize_thickbox()}});ThriveLeads.views.TriggerSettings=b.extend({events:{"change #trigger-type":"triggerChange","click .tve-save-trigger":"triggerSave"},model:null,$trigger_type:null,initialize:function(){this.$trigger_type=this.$el.find("#trigger-type")},triggerChange:function(a){this.$el.find(".trigger-settings").hide(0).filter("#trigger-settings-"+this.$trigger_type.val()).show(0),ThriveLeads.resize_thickbox()},triggerSave:function(a){var b=this;this.model.set({trigger:this.$trigger_type.val(),trigger_config:this.collect_config()}),this.btnLoading(a.currentTarget),ThriveLeads.showLoader(),this.model.save({},{success:function(){b.closeThickbox()}})},collect_config:function(){var a={};return this.$el.find("#trigger-settings-"+this.$trigger_type.val()).find(".trigger-config").each(function(){var b=jQuery(this);b.attr("disabled")||(a[b.attr("name")]=b.is("input[type=checkbox]")?b.is(":checked")?b.val():"":b.val())}),a}}),ThriveLeads.views.PositionSettings=b.extend({events:{"click .tve-save-position":"positionSave","click .tve-close-thickbox":tb_remove},model:null,positionSave:function(a){var b=this;this.model.set({position:this.$el.find(".form-position").val()}),this.btnLoading(a.currentTarget),ThriveLeads.showLoader(),b.closeThickbox(),this.model.save({},{success:function(){}})}}),ThriveLeads.views.MessagesList=Backbone.View.extend({className:"messagesList",render:function(){var a=this;return this.collection.each(function(b){a.$el.append(a.renderMessage(b))}),this},renderMessage:function(a){return _.template(ThriveLeads["const"].templates["messages/item"],{message:a})}}),ThriveLeads.views.lightbox={EditVariationTest:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/edit-variation-test"]),events:{"click .tve-edit-variation-test":"saveTest","change #tve-enable-test-settings":"toggleAutoWinSettings"},saveTest:function(a){var b=this,c=jQuery(a.target);this.model.set("auto_win_enabled",this.$el.find("input[name='auto_win_enabled']").is(":checked")),this.model.set("auto_win_min_conversions",this.$el.find('input[name="auto_win_min_conversions"]').val()),this.model.set("auto_win_min_duration",this.$el.find('input[name="auto_win_min_duration"]').val()),this.model.set("auto_win_chance_original",this.$el.find('input[name="auto_win_chance_original"]').val()),this.model.on("invalid",function(a,c){b.showErrors(a,c)}),this.model.isValid()&&(this.model.trigger("auto_win_changed"),c.html(ThriveLeads["const"].translations.Loading).removeClass("tve-edit-variation-test"),this.btnLoading(c),ThriveLeads.showLoader(),this.model.save({},{success:function(){b.closeThickbox(),ThriveLeads.hideLoader()}}))},showErrors:function(a,b){var c=this,d=0;clearTimeout(d),c.$el.find(".tve-block-error").remove(),_.each(b,function(a,b){if("auto_win_min_conversions"===b){var d=jQuery('<span class="tve-block-error" style="display: none"></span>');d.html(a),c.$el.find('input[name="auto_win_min_conversions"]').parent().parent().append(d),d.show()}if("auto_win_min_duration"===b){var d=jQuery('<span class="tve-block-error" style="display: none"></span>');d.html(a),c.$el.find('input[name="auto_win_min_duration"]').parent().parent().append(d),d.show()}if("auto_win_chance_original"===b){var d=jQuery('<span class="tve-block-error" style="display: none"></span>');d.html(a),c.$el.find('input[name="auto_win_chance_original"]').parent().parent().append(d),d.show()}}),d=setTimeout(function(){c.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()})},5e3)},toggleAutoWinSettings:function(a){var b=jQuery(a.currentTarget);b.is(":checked")?this.$el.find(".tve-winner-settings-input").show(0):this.$el.find(".tve-winner-settings-input").hide(0),setTimeout(ThriveLeads.resize_thickbox,0)}}),StopVariationTest:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/stop-variation-test"]),events:{"click .tve-test-item-winner":"setWinner"},renderTestItems:function(){var a=this.$el.find("#tve-stop-variation"),b=this,c=b.collection.getHighestRateItem();return a.empty(),this.collection.each(function(b){b.set("show_graph",!1);var d=new ThriveLeads.views.TestItem({model:b,highest_id:c});a.append(d.render().el)}),this},setWinner:function(a){a.preventDefault();var b=this,c=jQuery(a.target),d=this.collection.get(parseInt(c.data("test-item-id")));this.btnLoading(c),ThriveLeads.showLoader(),d.set("is_winner",!0),d.save({},{success:function(a,c){if(b.model.get("test_type")==ThriveLeads["const"].group_test_type)ThriveLeads.addMessage({text:ThriveLeads["const"].translations.SetWinnerGroupMessage}),ThriveLeads.objects.groups=new ThriveLeads.collections.Groups(c),ThriveLeads.objects.groups.findWhere({ID:parseInt(a.get("main_group_id"))}).set("details_expanded",!0),ThriveLeads.router.navigate("#dashboard",{trigger:!0});else if(b.model.get("test_type")==ThriveLeads["const"].shortcode_test_type)ThriveLeads.addMessage({text:ThriveLeads["const"].translations.SetWinnerShortcodeMessage}),ThriveLeads.objects.shortcodeCollection.findWhere({ID:parseInt(d.get("main_group_id"))}).set("active_test",null),ThriveLeads.router.navigate("#shortcode/"+d.get("main_group_id"),{trigger:!0});else if(b.model.get("test_type")==ThriveLeads["const"].two_step_lightbox_test_type)ThriveLeads.addMessage({text:ThriveLeads["const"].translations.SetWinnerTwoStepLightboxMessage}),ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(d.get("main_group_id"))}).set("active_test",null),ThriveLeads.router.navigate("#2step-lightbox/"+d.get("main_group_id"),{trigger:!0});else{ThriveLeads.addMessage({text:ThriveLeads["const"].translations.SetWinnerFormTypeMessage});var e=ThriveLeads.objects.groups.findWhere({ID:parseInt(d.get("main_group_id"))}).get("form_types").findWhere({ID:parseInt(d.get("form_type_id"))});e.set("active_test",new ThriveLeads.models.Test),ThriveLeads.router.navigate("#form-type/"+d.get("form_type_id"),{trigger:!0})}},complete:function(a){b.closeThickbox()}}),ThriveLeads.showLoader()}}),VariationTest:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/variation-test"]),events:{"click #tve-winner-test-settings h2":"toggleSettings","click #tve-enable-test-settings":"toggleProperties","click .tve-start-variation-test":"addTest","click .tve-redirect-to-form-type":"toFormType"},renderFormTypes:function(){var a=this.$el.find("#tve-form-types-list");a.show();var b=_.template(ThriveLeads["const"].templates["form-type/checkbox"]);this.model.get("form_types").each(function(c){a.append(b({form:c,active_test:c.get("active_test").toJSON()}))})},addTest:function(){var a=this,b=new ThriveLeads.models.Test({title:this.$el.find('input[name="test_title"]').val(),notes:this.$el.find('textarea[name="test_notes"]').val(),auto_win_enabled:this.$el.find("input[name='auto_win_enabled']").is(":checked"),auto_win_min_conversions:this.$el.find('input[name="auto_win_min_conversions"]').val(),auto_win_min_duration:this.$el.find('input[name="auto_win_min_duration"]').val(),auto_win_chance_original:this.$el.find('input[name="auto_win_chance_original"]').val(),main_group_id:a.model.get("ID")});if(this.$el.find('input[name="form-types[]"]').length){var c=[];this.$el.find('input[name="form-types[]"]:checked').each(function(){c.push(jQuery(this).val())}),b.set("form_types",c),b.setAsGroupType()}this.model instanceof ThriveLeads.models.Shortcode&&b.setAsShortcodeType(),this.model instanceof ThriveLeads.models.TwoStepLightbox&&b.setAsTwoStepLightboxType(),b.on("invalid",function(b,c){a.onInvalid(b,c)}),b.isValid()&&(ThriveLeads.showLoader(),b.save({},{success:function(c,d){if(b.set("id",d.id),b.get("form_types"))d.item_ids=d.form_types,a.model.get("active_tests").add(new ThriveLeads.models.Test(d));else if(a.model instanceof ThriveLeads.models.Shortcode)ThriveLeads.objects.shortcodeCollection.findWhere({ID:parseInt(b.get("main_group_id"))}).set("active_test",b),ThriveLeads.objects.Shortcode.set("active_test",b),ThriveLeads.router.navigate("#test/"+b.get("id")+"/completed",{trigger:!0});else if(a.model instanceof ThriveLeads.models.TwoStepLightbox)ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(b.get("main_group_id"))}).set("active_test",b),ThriveLeads.objects.TwoStepLightbox.set("active_test",b),ThriveLeads.router.navigate("#test/"+b.get("id")+"/completed",{trigger:!0});else{var e=ThriveLeads.objects.groups.findWhere({ID:a.model.get("post_parent")}),f=e.get("form_types").findWhere({ID:a.model.get("ID")});f.set("active_test",b),ThriveLeads.router.navigate("#test/"+b.get("id")+"/completed",{trigger:!0})}},complete:function(){a.closeThickbox(),ThriveLeads.hideLoader()}}))},onInvalid:function(a,b){var c=this;c.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(b,function(a,b){if("title"===b){var d=jQuery('<p class="tve-error" style="display: none; margin-top: 0;font-size:90%"></p>');d.html(a),c.$el.find('input[name="test_title"]').after(d),d.show()}if("auto_win_min_conversions"===b){var d=jQuery('<span class="tve-block-error" style="display: none"></span>');d.html(a),c.$el.find('input[name="auto_win_min_conversions"]').parent().parent().append(d),d.show()}if("auto_win_min_duration"===b){var d=jQuery('<span class="tve-block-error" style="display: none"></span>');d.html(a),c.$el.find('input[name="auto_win_min_duration"]').parent().parent().append(d),d.show()}if("auto_win_chance_original"===b){var d=jQuery('<span class="tve-block-error" style="display: none"></span>');d.html(a),c.$el.find('input[name="auto_win_chance_original"]').parent().parent().append(d),d.show()}if("form_types"===b){var d=jQuery('<p class="tve-error" style="display: none"></p>');d.html(a),c.$el.find("#tve-form-types-list").before(d),d.show()}}),testErrortimer=setTimeout(function(){c.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()})},5e3)},toggleSettings:function(){var a=this.$el.find("#tve-winner-test-container"),b=this.$el.find("#tve-winner-test-settings");a.is(":visible")?(a.hide(0),b.find(".tve-icon-minus-circle").addClass("tve-icon-plus-circle").removeClass("tve-icon-minus-circle")):(a.fadeIn("fast"),b.find(".tve-icon-plus-circle").addClass("tve-icon-minus-circle").removeClass("tve-icon-plus-circle")),setTimeout(ThriveLeads.resize_thickbox,0)},toggleProperties:function(a){a.target.checked?this.$el.find(".tve-winner-settings-input").show(0):this.$el.find(".tve-winner-settings-input").hide(0),setTimeout(ThriveLeads.resize_thickbox,0)}}),AddGroup:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/add-group"]),events:{"click .tve-add-lead-group":"addGroup"},addGroup:function(b){var c=a(b.currentTarget),d=new ThriveLeads.models.Group({post_title:this.$el.find(".post_title").val(),order:ThriveLeads.objects.groups.length}),e=this;d.on("invalid",function(a,b){e.onInvalid(a,b)}),d.isValid()&&(this.btnLoading(c),ThriveLeads.showLoader(),d.save({},{success:function(a,b){a.set("ID",b)},complete:function(){ThriveLeads.objects.groups.add(d),e.$el.find(".post_title").val(""),e.closeThickbox(),ThriveLeads.hideLoader()}}))},onInvalid:function(a,b){var c=this;c.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(b,function(a,b){if("post_title"===b){var d=jQuery('<p class="tve-error" style="display: none; margin-top: 0;font-size:90%"></p>');d.html(a),c.$el.find('input[name="post_title"]').addClass("tve-leads-input-error").before(d),d.show()}}),testErrortimer=setTimeout(function(){c.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()}),c.$el.find("input").removeClass("tve-leads-input-error")},5e3)}}),AddShortcode:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/add-shortcode"]),events:{"click .tve-add-lead-shortcode":"addShortcode"},addShortcode:function(b){var c=a(b.currentTarget),d=new ThriveLeads.models.Shortcode({post_title:this.$el.find(".post_title").val()}),e=this;d.on("invalid",function(a,b){e.onInvalid(a,b)}),d.isValid()&&(this.btnLoading(c),ThriveLeads.showLoader(),d.save({},{success:function(a,b){a.set("ID",b)},complete:function(){ThriveLeads.objects.shortcodeCollection.add(d),e.$el.find(".post_title").val(""),e.closeThickbox(),ThriveLeads.hideLoader()}}))},onInvalid:function(a,b){var c=this;c.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(b,function(a,b){if("post_title"===b){var d=jQuery('<p class="tve-error" style="display: none; margin-top: 0;font-size:90%"></p>');d.html(a),c.$el.find('input[name="post_title"]').addClass("tve-leads-input-error").before(d),d.show()}}),testErrortimer=setTimeout(function(){c.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()}),c.$el.find("input").removeClass("tve-leads-input-error")},5e3)}}),AddTwoStepLightbox:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/add-two-step-lightbox"]),events:{"click .tve-add-lead-two-step-lightbox":"addTwoStepLightbox"},addTwoStepLightbox:function(b){var c=a(b.currentTarget),d=new ThriveLeads.models.TwoStepLightbox({post_title:this.$el.find(".post_title").val()}),e=this;d.on("invalid",function(a,b){e.onInvalid(a,b)}),d.isValid()&&(this.btnLoading(c),ThriveLeads.showLoader(),d.save({},{success:function(a,b){a.set("ID",b)},complete:function(){ThriveLeads.objects.TwoStepLightboxCollection.add(d),e.$el.find(".post_title").val(""),e.closeThickbox(),ThriveLeads.hideLoader()}}))},onInvalid:function(a,b){var c=this;c.$el.find(".tve-error, .tve-block-error").remove(),"undefined"!=typeof testErrortimer&&clearTimeout(testErrortimer),_.each(b,function(a,b){if("post_title"===b){var d=jQuery('<p class="tve-error" style="display: none; margin-top: 0;font-size:90%"></p>');d.html(a),c.$el.find('input[name="post_title"]').addClass("tve-leads-input-error").before(d),d.show()}}),testErrortimer=setTimeout(function(){c.$el.find(".tve-error, .tve-block-error").slideUp(200,function(){jQuery(this).remove()}),c.$el.find("input").removeClass("tve-leads-input-error")},5e3)}}),ConfirmDeleteGroup:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/delete-group"]),events:{"click .tve-confirm-delete-lead-group":"deleteGroup"},deleteGroup:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),ThriveLeads.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){d.closeThickbox(),ThriveLeads.hideLoader()}})}}),ConfirmDeleteShortcode:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/delete-shortcode"]),events:{"click .tve-confirm-delete-lead-group":"deleteGroup"},deleteGroup:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),ThriveLeads.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){d.closeThickbox(),ThriveLeads.hideLoader()}})}}),ConfirmDeleteTwoStepLightbox:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/delete-two-step-lightbox"]),events:{"click .tve-confirm-delete-lead-group":"deleteGroup"},deleteGroup:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),ThriveLeads.showLoader(),this.model.destroy({success:function(){},error:function(){},complete:function(){d.closeThickbox(),ThriveLeads.hideLoader()}})}}),AddForm:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/add-form-variation"]),events:{"click .tve-add-form":"addForm"},addForm:function(b){var c,d=a(b.currentTarget),e=this;if(c=this.model.get("post_type")===ThriveLeads["const"].tve_leads_post_shortcode_type||this.model.get("form_variation")instanceof ThriveLeads.models.ShortcodeVariation?new ThriveLeads.models.ShortcodeVariation:this.model.get("post_type")===ThriveLeads["const"].tve_leads_post_two_step_lightbox_type||this.model.get("form_variation")instanceof ThriveLeads.models.TwoStepLightboxVariation?new ThriveLeads.models.TwoStepLightboxVariation:new ThriveLeads.models.FormVariation,"re-add"==this.model.get("state")){var f=this.model.get("form_variation").toJSON();c.set(f),c.set("key",""),c.set("post_status","publish"),c.set("readd_from",f.key)}else c.set("post_parent",this.model.get("form_type_id"));c.set("post_title",this.$el.find(".post_title").val()),
this.btnLoading(d),ThriveLeads.showLoader();var g=c.save({});ThriveLeads.addFailCallback(g,this),g.done(function(a){c.set(a)}).always(function(){if(!g.failed){if(e.model.get("post_type")===ThriveLeads["const"].tve_leads_post_shortcode_type||e.model.get("form_variation")instanceof ThriveLeads.models.ShortcodeVariation){e.model.get("content_locking")&&c.set("content_lock_display","hide"),c.set("is_control",!ThriveLeads.objects.Shortcode.get("variations").length),ThriveLeads.objects.Shortcode.get("variations").add(c),ThriveLeads.objects.Shortcode.trigger("change");try{ThriveLeads.objects.shortcodeCollection.findWhere({ID:e.model.get("form_type_id")}).get("variations").add(c)}catch(a){ThriveLeads.objects.shortcodeCollection.findWhere({ID:parseInt(e.model.get("form_variation").get("post_parent"))}).get("variations").add(c)}}else if(e.model.get("post_type")===ThriveLeads["const"].tve_leads_post_two_step_lightbox_type||e.model.get("form_variation")instanceof ThriveLeads.models.TwoStepLightboxVariation){c.set("is_control",!ThriveLeads.objects.TwoStepLightbox.get("variations").length),ThriveLeads.objects.TwoStepLightbox.get("variations").add(c),ThriveLeads.objects.TwoStepLightbox.trigger("change");try{ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:e.model.get("form_type_id")}).get("variations").add(c)}catch(a){ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(e.model.get("form_variation").get("post_parent"))}).get("variations").add(c)}}else{c.set("is_control",!ThriveLeads.objects.FormType.get("variations").length),ThriveLeads.objects.FormType.get("variations").add(c),ThriveLeads.objects.FormType.trigger("change");try{ThriveLeads.objects.groups.findWhere({ID:e.model.get("group_id")}).get("form_types").findWhere({ID:e.model.get("form_type_id")}).get("variations").add(c)}catch(a){console.log(a.message)}}e.$el.find(".post_title").val(""),e.closeThickbox(),ThriveLeads.hideLoader()}})}}),ArchiveForm:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/archive-form-variation"]),events:{"click .tve-confirm":"confirm"},confirm:function(b){var c=a(b.currentTarget),d=this;this.btnLoading(c),ThriveLeads.showLoader(),d.closeThickbox();var e=this.model.get("post_status");this.model.set("post_status",ThriveLeads["const"].test_status.archived);var f=this.model.save({});ThriveLeads.addFailCallback(f),f.done(function(a){d.model.set(a)}),f.always(function(){if(f.failed)return void d.model.set("post_status",e);var a;a=d.model instanceof ThriveLeads.models.ShortcodeVariation?ThriveLeads.objects.Shortcode:d.model instanceof ThriveLeads.models.TwoStepLightboxVariation?ThriveLeads.objects.TwoStepLightbox:ThriveLeads.objects.FormType,a.get("variations_archived").push(d.model),a.get("variations").remove(d.model),a.get("variations").determineControl(),a.trigger("change");try{if(a instanceof ThriveLeads.models.FormType){var b=ThriveLeads.objects.groups.findWhere({ID:a.get("post_parent")}),c=b.get("form_types").findWhere({ID:parseInt(a.get("ID"))});c.get("variations").remove(d.model),b.trigger("change")}else ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(d.model.get("post_parent"))}).get("variations").remove(d.model)}catch(g){console.log(g.message)}})}}),ConfirmDeleteVariation:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/delete-form"]),events:{"click .tve-confirm-delete-form":"deleteVariation"},deleteVariation:function(a){var b=this,c=this.model.toJSON();ThriveLeads.showLoader(),b.closeThickbox();var d=this.model.destroy({data:jQuery.param(c)});ThriveLeads.addFailCallback(d,this),d.always(function(){if(!d.failed){if(ThriveLeads.hideLoader(),b.model instanceof ThriveLeads.models.ShortcodeVariation)return ThriveLeads.objects.Shortcode.trigger("change"),void setTimeout(function(){jQuery('.tl-clickable[data-target="#tl-toggle-forms"]').click()},0);if(b.model instanceof ThriveLeads.models.TwoStepLightboxVariation)return ThriveLeads.objects.TwoStepLightbox.trigger("change"),void setTimeout(function(){jQuery('.tl-clickable[data-target="#tl-toggle-forms"]').click()},0);ThriveLeads.objects.FormType.trigger("change"),setTimeout(function(){jQuery('.tl-clickable[data-target="#tl-toggle-forms"]').click()},0)}})}}),ConfirmResetStats:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/reset-form-stats"]),events:{"click .tve-confirm-reset":"resetStats"},resetStats:function(a){var b=this;if(this.model instanceof ThriveLeads.models.ShortcodeVariation)var c=ThriveLeads.objects.shortcodeCollection.findWhere({ID:parseInt(b.model.get("post_parent"))});else if(this.model instanceof ThriveLeads.models.TwoStepLightboxVariation)var c=ThriveLeads.objects.TwoStepLightboxCollection.findWhere({ID:parseInt(b.model.get("post_parent"))});else var c=ThriveLeads.objects.groups.findWhere({ID:parseInt(ThriveLeads.objects.FormType.get("post_parent"))});ThriveLeads.showLoader(),c.decreaseStatistics(this.model),this.model.resetStatistics({success:function(a){b.model.set(a)},error:function(){},complete:function(){b.closeThickbox(),ThriveLeads.hideLoader()}})}}),ConfirmFormTypeResetStats:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/reset-form-type-stats"]),events:{"click .tve-confirm-reset":"resetStats"},resetStats:function(a){var b=this;if(this.model instanceof ThriveLeads.models.Shortcode||this.model instanceof ThriveLeads.models.TwoStepLightbox)var c=this.model;else var c=ThriveLeads.objects.groups.findWhere({ID:parseInt(this.model.get("post_parent"))});ThriveLeads.showLoader(),this.model.resetStatistics({success:function(){c.decreaseStatistics(b.model)},error:function(){},complete:function(){b.closeThickbox(),ThriveLeads.hideLoader()}})}}),DisplayFrequencySettings:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/display-frequency-settings"]),events:{"change .input-display-frequency":"inputChanged","click .tve-save-frequency":"saveValue"},afterOpen:function(){var a=this;this.$input=this.$el.find(".input-display-frequency"),this.$slider=this.$el.find(".slider-display-frequency").slider({min:0,max:100,step:1,slide:function(b,c){a.$input.val(c.value)}}),this.$input.change()},inputChanged:function(){var a=parseInt(this.$input.val());(isNaN(a)||0>a||a>100)&&(a=10),a!=this.$input.val()&&this.$input.val(a),this.$slider.slider("value",a)},clearData:function(){this.$input=null,this.$slider.slider("destroy"),this.$slider=null},saveValue:function(){this.model.set("display_frequency",this.$input.val()),ThriveLeads.showLoader(),this.closeThickbox();var a=this,b=this.model.save({});ThriveLeads.addFailCallback(b),b.done(function(b){a.model.set(b),ThriveLeads.hideLoader()})}}),AnimationSettings:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/animation-settings"]),events:{"change #animation-type":"animate","click .tve-save-animation":"saveValue"},afterOpen:function(){this.$el.find("#animation-type").val(this.model.get("display_animation")),this.target=this.$el.find("#tve-anim-target"),this.animate()},animate:function(){function a(){clearTimeout(c),d.css("display","none").removeClass(function(a,b){var c=b.split(" "),d="";return _.each(c,function(a){0===a.indexOf("tl-anim")&&(d+=a)}),d}).removeClass("tve-leads-triggered").addClass("tl-anim-"+b),setTimeout(function(){d.css("display","")},400),setTimeout(function(){d.addClass("tve-leads-triggered")},500)}var b=this.$el.find("#animation-type").val(),c=0,d=this.target;jQuery("#TB_ajaxContent").css("overflow","hidden"),setTimeout(a,100)},saveValue:function(){this.model.set("display_animation",this.$el.find("#animation-type").val()),ThriveLeads.showLoader(),this.closeThickbox();var a=this,b=this.model.save({});ThriveLeads.addFailCallback(b),b.done(function(b){a.model.set(b),ThriveLeads.hideLoader()})}}),LockDisplaySettings:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/lock-display-settings"]),events:{"click .tve-save-lead-lock":"saveValue"},afterOpen:function(){jQuery(document).on("change","#tve-lock-display",function(){"blur"===jQuery(this).val()?jQuery(".tve-blur-warning").show():jQuery(".tve-blur-warning").hide()}),jQuery("#tve-lock-display").val(this.model.get("content_lock_display")).trigger("change")},saveValue:function(){this.model.set("display_animation",this.$el.find("#tve-lock-display").val()),this.model.set("content_lock_display",this.$el.find("#tve-lock-display").val()),ThriveLeads.showLoader(),this.closeThickbox();var a=this,b=this.model.save({});ThriveLeads.addFailCallback(b),b.done(function(b){a.model.set(b),ThriveLeads.hideLoader()})}}),PHPInsertCode:b.extend({template:_.template(ThriveLeads["const"].templates["lightbox/php-insert-code"]),afterOpen:function(){ThriveLeads.bindZClip(this.$el.find("a.tve-copy-to-clipboard")),this.$el.find(".tve-php-code").val(this.model.getPHPCode())}})}});